# 7ì¥ ë„ë©”ì¸ ì„œë¹„ìŠ¤

Created: July 12, 2022 10:37 PM

# 7.1 ì—¬ëŸ¬ ì• ê·¸ë¦¬ê±°íŠ¸ê°€ í•„ìš”í•œ ê¸°ëŠ¥

ë„ë©”ì¸ ì˜ì—­ì˜ ì½”ë“œ ì‘ì„±ì„ í•˜ë©´ í•œ ì• ê·¸ë¦¬ê±°íŠ¸ë¡œ ê¸°ëŠ¥ êµ¬í˜„ì´ ë¶ˆê°€í•œ ê²½ìš°ê°€ ìˆìŒ â†’ ëŒ€í‘œì ìœ¼ë¡œ ê²°ì œ ê¸ˆì•¡ ê³„ì‚°

```java
ê²°ì œ ê¸ˆì•¡ ê³„ì‚°
1. ìƒí’ˆ ì• ê·¸ë¦¬ê±°íŠ¸ : êµ¬ë§¤ ìƒí’ˆ ê°€ê²© í•„ìš”, ìƒí’ˆì— ë”°ë¼ ë°°ì†¡ë¹„ ì¶”ê°€
2. ì£¼ë¬¸ ì• ê·¸ë¦¬ê±°íŠ¸ : ìƒí’ˆë³„ë¡œ êµ¬ë§¤ ê°œìˆ˜ê°€ í•„ìš”
3. í• ì¸ ì¿ í° ì• ê·¸ë¦¬ê±°íŠ¸ : ì¿ í°ë³„ë¡œ ì§€ì •í•œ í• ì¸ ê¸ˆì•¡ì´ë‚˜ ì¡°ê±´ì— ë”°ë¼ ì¤‘ë³µ ì‚¬ìš©í•  ìˆ˜ ìˆê±°ë‚˜ ë“±ë“±ì˜ 
ì œì•½ì¡°ê±´ì— ë”°ë¼ í• ì¸ ê³„ì‚°ì´ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆìŒ
4. íšŒì› ì• ê·¸ë¦¬ê±°íŠ¸ : íšŒì› ë“±ê¸‰ì— ë”°ë¼ ì¶”ê°€ í• ì¸ì´ ê°€ëŠ¥
```



ê²°ì œ ê¸ˆì•¡ ê³„ì‚° ë¡œì§ì€ ì–´ë–¤ ì• ê·¸ë¦¬ê±°íŠ¸ì— ìˆì–´ì•¼ í• ê¹Œ? ì£¼ë¬¸ ì• ê·¸ë¦¬ê±°íŠ¸?

â†’ í•œ ì• ê·¸ë¦¬ê±°íŠ¸ì— ë„£ê¸° ì• ë§¤í•œ ë„ë©”ì¸ ê¸°ëŠ¥ì„ ì–µì§€ë¡œ íŠ¹ì • ì• ê·¸ë¦¬ê±°íŠ¸ì— êµ¬í˜„í•˜ë©´ ì•ˆëœë‹¤. ì™¸ë¶€ ì˜ì¡´ì´ ë§ì•„ì§€ê³  ìˆ˜ì •ì´ ì–´ë ¤ì›Œì§

- í•´ê²° ë°©ë²•ì€ ë„ë©”ì¸ ì„œë¹„ìŠ¤

# 7.2 ë„ë©”ì¸ ì„œë¹„ìŠ¤

<aside>
ğŸ’¡ ë„ë©”ì¸ ì„œë¹„ìŠ¤ëŠ” ë„ë©”ì¸ ì˜ì—­ì— ìœ„ì¹˜í•œ ë„ë©”ì¸ ë¡œì§ì„ í‘œí˜„í•  ë•Œ ì‚¬ìš©

</aside>

- ì£¼ë¡œ ë‹¤ìŒ ìƒí™©ì—ì„œ ë„ë©”ì¸ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©
    - ê³„ì‚° ë¡œì§ : ì—¬ëŸ¬ ì• ê·¸ë¦¬ê±°íŠ¸ í•„ìš” ë˜ëŠ” ë³µì¡í•œ ê³„ì‚° ë¡œì§
    - ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™ì´ í•„ìš”í•œ ë„ë©”ì¸ ë¡œì§

## 7.2.1 ê³„ì‚° ë¡œì§ê³¼ ë„ë©”ì¸ ì„œë¹„ìŠ¤

í• ì¸ê¸ˆì•¡ ê³„ì‚°ì„ ìœ„í•œ ë„ë©”ì¸ ì„œë¹„ìŠ¤ ì˜ˆì‹œ

```java
public class DiscountCalculationService {
 public Money calculateDiscountAmounts(
   List<OrderLIne> orderLines,
   List<Coupon> coupons,
   MemberGrade grade) {
  Money couponDiscount = coupons.stream()
                  .map(coupon -> calculateDiscount(coupon))
                  .reduce(Money(0), (v1, v2) -> v1.add(v2));

  Money membershipDiscount = calculateDiscount(orderer.getMember().getGrade());

  return couponDiscount.add(membershipDiscount);
 }

 ...
}
```

ìœ„ì˜ í• ì¸ê³„ì‚° ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ì£¼ì²´

- ì• ê·¸ë¦¬ê±°íŠ¸
- ì‘ìš©ì„œë¹„ìŠ¤

ì• ê·¸ë¦¬ê±°íŠ¸ê°€ í• ì¸ê³„ì‚° ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œ

```java
public class Order {
 public void calculateAmounts(
   DiscountCalculationService disCalSvc, MemberGrade grade) {
  Money totalAmounts = getTotalAmounts();
  Money discountAmounts = disCalSvc.calculateDiscountAmounts(this.orderLInes, this.coupons, greade);
  this.paymentAmounts = totalAmounts.minus(discountAmounts);
 }
 ...
```

```java
public class OrderService {
 private DiscountCalculationService discountCalculationService;

 @Transactional
 public OrderNo placeOrder(OrderRequest orderRequest) {
  OrderNo orderno = orderRepository.nextId();
  Order order = createOrder(orderNo, orderRequest);
  orderRepository.save(order);
  // ì‘ìš© ì„œë¹„ìŠ¤ ì‹¤í–‰ í›„ í‘œí˜„ ì˜ì—­ì—ì„œ í•„ìš”í•œ ê°’ ë¦¬í„´

  return orderNo;
 }

 private Order createOrder(OrderNo orderNo, OrderRequest orderReq) {
  Member member =findMember(orderReq.getOrdererId());
  Order order = new Order(orderNo, orderReq.gerOrderLines(),
       orderReq.getCoupons(), createOrderer(member),
       orderReq.getShippingInfo());
  order.calculateAmounts(this.discountCalculationService, member.getGrade());
  return order;
 }
 ...
}
```

- ì• ê·¸ë¦¬ê±°íŠ¸ì— ë„ë©”ì¸ ì„œë¹„ìŠ¤ ì£¼ì…ì€ ì¢‹ì§€ ì•Šë‹¤ : ì• ê·¸ë¦¬ê±°íŠ¸ê°€ ë„ë©”ì¸ ì„œë¹„ìŠ¤ì— ì˜ì¡´

ê³„ì¢Œ ì´ì²´ ê´€ë ¨í•œ ë„ë©”ì¸ ì„œë¹„ìŠ¤ ì˜ˆì‹œ

```java
public class TransferService {
 public void transfer(Account fromAcc, Account toAcc, Money amounts) {
  fromAcc.withdraw(amounts);
  toAcc.credit(amounts);
 }
  ...
}
```

<aside>
ğŸ’¡ ë„ë©”ì¸ ì„œë¹„ìŠ¤ êµ¬ë¶„ ë°©ë²• : í•´ë‹¹ ë¡œì§ì´ ì• ê·¸ë¦¬ê±°íŠ¸ì˜ ìƒíƒœë¥¼ ë³€ê²½ or ìƒíƒœ ê°’ì„ ê³„ì‚°í•˜ë©´ ë„ë©”ì¸ ì„œë¹„ìŠ¤

</aside>

## 7.2.2 ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™ê³¼ ë„ë©”ì¸ ì„œë¹„ìŠ¤

â†’ ì• ê·¸ë¦¬ê±°íŠ¸ ì •ë³´ ì°¸ê³ í•˜ì—¬ ì™¸ë¶€ ì‹œìŠ¤í…œ api í˜¸ì¶œí•˜ëŠ” ê²ƒë„ ë„ë©”ì¸ ì„œë¹„ìŠ¤

## 7.2.3 ë„ë©”ì¸ ì„œë¹„ìŠ¤ íŒ¨í‚¤ì§€ ìœ„ì¹˜

![image](https://user-images.githubusercontent.com/19850434/185752915-7c309b10-8d92-414f-8100-b00cac1262ce.png)


## 7.2.4 ë„ë©”ì¸ ì„œë¹„ìŠ¤ì˜ ì¸í„°í˜ì´ìŠ¤ì™€ í´ë˜ìŠ¤

![image](https://user-images.githubusercontent.com/19850434/185752926-591960dd-dadc-4274-89cc-4f7ffac074db.png)

ë„ë©”ì¸ ì„œë¹„ìŠ¤ê°€ íŠ¹ì • ê¸°ìˆ ì— ì¢…ì†ë˜ì—ˆë‹¤ë©´ Infra íŒ¨í‚¤ì§€ì— êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë¶„ë¦¬í•˜ë©´ ì¢‹ì€ ì 

- íŠ¹ì • êµ¬í˜„ì— ì¢…ì†ë˜ëŠ” ê²ƒì„ ë°©ì§€
- í…ŒìŠ¤íŠ¸ê°€ ì‰¬ì›Œì§
