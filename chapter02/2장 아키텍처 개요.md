# 2장 아키텍처 개요

Created: July 12, 2022 10:37 PM

# 2.1 4개의 영역

> 표현, 응용, 도메인, 인프라스트럭처는 아키텍처를 설계할 때 출현하는 전형적인 4가지 영역
>

### 표현(Presentation)

- HTTP 요청을 받아서 객체로 변환
- 객체를 Json으로 변환하여 HTTP응답

### 응용(Application)

- 표현영역을 통해 전달받은 요청을 처리하는 영역
- 도메인 영역의 도메인 모델을 활용하여 사용자 요청에 대한 구현
- 예) ‘주문 등록', ‘주문 취소', ‘상품 상세 조회’

### 도메인(Domain)

- Order, OrderLine, ShippingInfo와 같은 도메인 모델이 위치하는 영역
- 핵심 로직을 구현
- 예) ‘배송지 변경', ‘결제 완료', ‘주문 총액 계산’

### 인프라스트럭처(Infrastructure)

- 구현 기술에 대한 것을 다룸
- 실제 DB(Mysql, Maria, Oracle)이나 SMTP, Rest API 호출 등 저수준의 실제 동작을 처리

# 2.2 계층 구조 아키텍처(Layered Architecture)

<aside>
💡 표현 → 응용 → 도메인 → 인프라스트럭처 하위 방향으로만 의존

</aside>

### 결국 기능이 하위 모듈의 구현에 종속된다 → 이때의 문제점?

1. 테스트가 어렵다
2. 구현 방식을 변경하기 어렵다

# DIP(Dependency Inversion Principle)

- SOLID 원칙에도 있는 유명한 규칙
- 의존성을 하위 모듈 방향이 아닌 상위 모듈로 역전시키는 방법
    - 구현체의 변경을 손쉽게 함
    - 테스트 시에도 가짜 구현체를 손쉽게 넣을 수 있게 해줌
- 실무에서 겪은 케이스
    - 상품권에서 가짜번호 반복 실패 차단 구현
    - 레디스를 사용해서 구현함
    - 레디스 클라이언트 중 Redisson을 사용했는데 Redisson의 상세 구현에 의존적인 구현이 됨
    - Interface 추출 및 상위 모듈의 입맛에 맞는 방식으로 호출방식을 변경하고 구현부에서 구현(하려고 했으나 바빠서 못함;;ㅋㅋ)

![image](https://user-images.githubusercontent.com/19850434/178521626-5f42c1ec-4c19-4c08-bf3d-a69ec3cfd1ea.png)

![image](https://user-images.githubusercontent.com/19850434/178521675-e676b1a2-acf8-4722-8b37-45ecc1622460.png)

# 2.4 도메인 영역의 주요 구성 요소

- 엔티티 : 고유의 식별자를 갖으며 자신의 라이프 사이클을 가짐
- 밸류 : 하나의 값을 표현, 식별자가 없음
- 애그리거트 : 연관된 엔티티와 밸류 객체를 개념적으로 하나로 묶은 것
- 리포지터리 : 도메인 모델의 영속성 처리
- 도메인 서비스 : ‘할인 금액 계산'은 상품, 쿠폰, 회원 등급, 구매 금액 등 다양한 조건을 이용하여 구현함. 이렇게 도메인 로직이 여러 엔티티와 밸류를 필요로 하게 되면 도메인 서비스에서 구현

### 2.4.1 엔티티와 밸류

- 테이블 엔티티와 도메인 모델의 엔티티는 차이가 있음
    - 도메인 모델의 엔티티는 자체적인 기능을 구현하고 기능 구현을 캡슐화하여 데이터 임의 수정을 방지
- DB 테이블 ≠ 도메인
    - 밸류 타입을 제대로 표현할 수 없음
    - 예) Order 엔티티가 Orderer(name, email)이라는 밸류를 포함하고 있는 경우
        - 개별 데이터로 저장(구조가 맞지 않음)하거나 하위 테이블로 저장해야 함(복잡)

### 2.4.2 애그리거트

<aside>
💡 애그리거트는 관련 객체를 하나로 묶은 군집. 대표적인 예가 주문

</aside>

- 루트 엔티티가 존재
    - 주문 애그리거트에서는 Order가 루트 엔티티
    - 루트 엔티티는 애그리거트가 구현해야할 기능을 제공
    - 애그리거트를 사용하는 코드는 루트 엔티티를 통해 애그리거트 내의 다른 엔티티나 밸류에 접근

![image](https://user-images.githubusercontent.com/19850434/178521716-1a078837-b3f5-4a51-9ce0-2d5f118ca9ed.png)

### 2.4.3 리포지터리

- 도메인이나 밸류는 요구사항에서 도출되는 부분
- 리포지터리는 실질적인 구현을 위한 도메인 모델

# 2.5 요청 처리 흐름

브라우저 → Controller → App Service → Domain Object → Repository

- 도메인과 리파지토리의 역할을 설명..?

# 2.6 인프라스트럭처 개요

- 인프라스트럭처에 대한 의존을 무조건적으로 배제하는 것은 불편하며 장점이 적음
    - JPA의 기능들이나 스프링의 기능은 적절히 사용

# 2.7 모듈 구성

- 패키지 구조에 대한 설명
- com.myshop 예시
    - 간단한 경우
        - ui → application → domain → infrastructure
    - 도메인이 큰 경우
        - catalog : ui → application → domain → infrastructure
        - order : ui → application → domain → infrastructure
        - member : ui → application → domain → infrastructure
        - 도메인 간 연결이 가능
        - 도메인 내에서도 애그리거트 기준으로 패키지 나눌 수 있음
            - catalog 하위에서 product와 category로 분류 가능

<aside>
💡 도메인 분리에 정답은 없으나 적절한 파일 수로 유지하는 것이 일반적으로 편리함

</aside>
